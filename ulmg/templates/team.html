{% extends 'base.html' %}

{% load ulmg_tags %}

{% block prenav %}
        {% if own_team and protect_tab or own_team and roster_tab %}{% include "includes/roster_status.html" %}{% endif %}
{% endblock %}


{% block content %}
{% include 'includes/team_topper.html' %}

<!-- Simple tab navigation -->
<div class="border-b border-gray-300 mb-4">
    <div class="flex flex-wrap gap-4 pb-2 text-sm">
        <span class="font-bold">Roster{% if num_owned %} ({{ num_owned }}){% endif %}</span>
        <a href="/teams/{{ team.abbreviation|lower }}/other/" class="underline">Trades & picks</a>
        {% if own_team %}
        <a href="/my/wishlist/draft/beta/" class="underline hidden md:inline">AA Draft</a>
        <a href="/my/{{ current_season_type }}/draft/" class="underline hidden md:inline">Open Draft</a>
        {% endif %}
    </div>
</div>

<!-- Team summary stats -->
<div class="grid grid-cols-2 gap-4 mb-6 text-xs">
    <div>
        <h3 class="font-bold mb-2 border-b border-gray-300 pb-1">By Level</h3>
        <table class="w-full">
            {% for level in level_distribution %}
            <tr>
                <td class="py-1">{% if level.level_order == 0 %}B{% elif level.level_order == 5 %}A{% else %}V{% endif %}</td>
                <td class="text-right py-1 font-bold">{{ level.level_order__count }}</td>
            </tr>
            {% endfor %}
        </table>
    </div>
    <div>
        <h3 class="font-bold mb-2 border-b border-gray-300 pb-1">By Position</h3>
        <table class="w-full">
            <tr>
                <td class="py-1">Hitters</td>
                <td class="text-right py-1 font-bold">{{ hitters|length }}</td>
            </tr>
            <tr>
                <td class="py-1">Pitchers</td>
                <td class="text-right py-1 font-bold">{{ pitchers|length }}</td>
            </tr>
        </table>
    </div>
</div>

<!-- Hitters by position -->
{% regroup hitters by position as position_players %}
{% for position in position_players %}
<div class="mb-8">
    <h2 class="text-lg font-bold mb-2 border-b border-gray-300 pb-1">{{ position.grouper }} ({{ position.list|length }})</h2>
    
    <div class="overflow-x-auto">
    <table class="w-full text-xs border-collapse min-w-max" data-sortable>
        <thead class="sticky top-0 bg-white z-10">
            <tr class="border-b border-gray-300">
                <th class="text-left py-1 sortable sticky left-0 bg-white z-20" data-sortable-type="alpha">Name</th>
                <th class="text-center py-1 sortable" data-sortable-type="numeric">Age</th>
                <th class="text-center py-1 sortable" data-sortable-type="alpha">Lvl</th>
                <th class="text-center py-1">ULMG</th>
                {% include "includes/hitter_stat_headers.html" %}
                {% if own_team and protect_tab or own_team and roster_tab %}
                <th class="text-center py-1 hidden sm:table-cell">Protect</th>
                {% endif %}
            </tr>
        </thead>
        <tbody>
        {% for p in position.list %}
        <tr class="level-{{ p.get_best_stat_season.clean_classification }} {% if p.get_best_stat_season %}{{ p.get_best_stat_season.role_type_class }}{% endif %} border-b border-gray-100">
            <td class="py-1 sticky left-0 bg-white border-r z-10">
                <a href="/players/{{ p.id }}/" class="underline">{{ p.name }}</a>
            </td>
            <td class="text-center py-1">{{ p.age|default_if_none:"-" }}</td>
            <td class="text-center py-1">{{ p.level|default_if_none:"" }}</td>
            <td class="text-center py-1 text-xs ulmg-status" data-playerid="{{ p.id }}">
                {% if p.is_ulmg_reserve %}ASR {% endif %}
                {% if p.is_ulmg_1h_pos %}HIT {% endif %}
                {% if p.is_ulmg_1h_c %}C {% endif %}
                <span class="ulmg-40man">{% if p.is_ulmg_35man_roster %}40-man {% endif %}</span>
                {% if p.is_ulmg_mlb_roster %}<strong>MLB</strong> {% endif %}
                {% if p.is_ulmg_aaa_roster %}AAA {% endif %}
                {% if p.is_ulmg_2h_draft %}2H{% endif %}
                {% if p.is_ulmg_2h_pos %}HIT {% endif %}
                {% if p.is_ulmg_2h_c %}C {% endif %}
            </td>
            {% include "includes/hitter_stat_cells_player.html" %}
            {% if own_team and protect_tab or own_team and roster_tab %}
            <td class="text-center py-1 hidden sm:table-cell">
                {% include "includes/player_protect_actions.html" %}
            </td>
            {% endif %}
        </tr>
        {% endfor %}
        </tbody>
    </table>
    </div>
</div>
{% endfor %}

<!-- Pitchers -->
<div class="mb-8">
    <h2 class="text-lg font-bold mb-2 border-b border-gray-300 pb-1">P ({{ pitchers|length }})</h2>
    
    <div class="overflow-x-auto">
    <table class="w-full text-xs border-collapse min-w-max" data-sortable>
        <thead class="sticky top-0 bg-white z-10">
            <tr class="border-b border-gray-300">
                <th class="text-left py-1 sortable sticky left-0 bg-white z-20" data-sortable-type="alpha">Name</th>
                <th class="text-center py-1 sortable" data-sortable-type="numeric">Age</th>
                <th class="text-center py-1 sortable" data-sortable-type="alpha">Lvl</th>
                <th class="text-center py-1">ULMG</th>
                {% include "includes/pitcher_stat_headers.html" %}
                {% if own_team and protect_tab or own_team and roster_tab %}
                <th class="text-center py-1 hidden sm:table-cell">Protect</th>
                {% endif %}
            </tr>
        </thead>
        <tbody>
        {% for p in pitchers %}
        <tr class="level-{{ p.get_best_stat_season.clean_classification }} {% if p.get_best_stat_season %}{{ p.get_best_stat_season.role_type_class }}{% endif %} border-b border-gray-100">
            <td class="py-1 sticky left-0 bg-white border-r z-10">
                <a href="/players/{{ p.id }}/" class="underline">{{ p.name }}</a>
            </td>
            <td class="text-center py-1">{{ p.age|default_if_none:"-" }}</td>
            <td class="text-center py-1">{{ p.level|default_if_none:"" }}</td>
            <td class="text-center py-1 text-xs ulmg-status" data-playerid="{{ p.id }}">
                {% if p.is_ulmg_reserve %}ASR {% endif %}
                {% if p.is_ulmg_1h_p %}P {% endif %}
                {% if p.is_ulmg_mlb_roster %}<strong>MLB</strong> {% endif %}
                {% if p.is_ulmg_aaa_roster %}AAA {% endif %}
                {% if p.is_ulmg_2h_draft %}2H {% endif %}
                <span class="ulmg-40man">{% if p.is_ulmg_35man_roster %}40-man{% endif %}</span>
                {% if p.is_ulmg_2h_p %}P {% endif %}
            </td>
            {% include "includes/pitcher_stat_cells_player.html" %}
            {% if own_team and protect_tab or own_team and roster_tab %}
            <td class="text-center py-1 hidden sm:table-cell">
                {% include "includes/player_protect_actions.html" %}
            </td>
            {% endif %}
        </tr>
        {% endfor %}
        </tbody>
    </table>
    </div>
</div>

{% if own_team %}
<div id="drop-modal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full hidden z-50" 
     data-mlb-roster-count="{{ mlb_roster_count|default:0 }}" 
     data-mlb-roster-size="{{ mlb_roster_size|default:30 }}">
    <div class="relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white">
        <div class="mt-3 text-center">
            <h3 class="text-lg font-medium text-gray-900">Confirm Player Drop</h3>
            <div class="mt-4">
                <p class="text-sm text-gray-600">Are you sure you want to drop <strong id="drop-player-name"></strong>?</p>
                <p class="text-sm text-red-600 mt-2">This action is irreversible.</p>
            </div>
            <div class="flex justify-center space-x-4 mt-6">
                <button id="cancel-drop" class="px-4 py-2 bg-gray-300 text-gray-700 rounded hover:bg-gray-400">Cancel</button>
                <button id="confirm-drop" class="px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700">Drop Player</button>
            </div>
        </div>
    </div>
</div>
{% endif %}

{% endblock %}

{% block extrascript %}
{% include "includes/my/wishlistjs.html" %}
{% include "includes/player_protect_actions_script.html" %}
{% endblock %}