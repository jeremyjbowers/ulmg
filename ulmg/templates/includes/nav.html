<!-- Simple text-based navigation -->
<nav class="flex items-center justify-between">
    <div class="flex items-center space-x-3">
        <a href="/" class="font-bold text-lg">THE ULMG</a>
        
        <!-- Mobile: menu button -->
        <button id="mobile-menu-button" class="sm:hidden border px-2 py-1 text-xs" aria-controls="mobile-menu" aria-expanded="false">Menu</button>

        <!-- Desktop links -->
        <a href="https://docs.google.com/document/d/e/2PACX-1vQmtw4gpA19fxNIFbSQZrF22z92eYbbhWPd_11PmH9fr2_vCUjTrMqZh_J2ySre0qrxKv_qtK-E9BTh/pub" target="_blank" class="underline hidden sm:inline">Constitution</a>
        <a href="/trades/" class="underline hidden sm:inline">Trades</a>
        
        <!-- Drafts dropdown (desktop) -->
        <div class="nav-dropdown hidden sm:block">
            <span class="underline cursor-pointer">Drafts ▼</span>
            <div class="nav-dropdown-content min-w-48 dropdown-right">
                {% for draft in draftnav %}
                <a href="{{ draft.url }}" class="block underline text-sm py-1">{{ draft.title }}</a>
                {% endfor %}
                <a href="https://ulmg.wordpress.com/category/draft/" target="_blank" class="block underline text-sm py-1">Archived drafts</a>
            </div>
        </div>
        
        <!-- Teams dropdown (desktop) -->
        <div class="nav-dropdown hidden sm:block">
            <span class="underline cursor-pointer font-bold">Teams ▼</span>
            <div class="nav-dropdown-content min-w-48 dropdown-right">
                {% regroup teamnav by division as division_teams %}
                {% for division in division_teams %}
                    {% if division.grouper %}
                    <div class="text-xs font-bold text-gray-600 px-2 py-1 border-b border-gray-200">{{ division.grouper }}</div>
                    {% endif %}
                    {% for team in division.list %}
                    <a href="/teams/{{ team.abbreviation|lower }}/{% if value %}?value=true{% endif %}" class="block underline text-sm py-1 pl-2">{{ team.abbreviation }}</a>
                    {% endfor %}
                {% endfor %}
            </div>
        </div>
        
        <!-- Player Search -->
        <form action="/search/name/" method="GET" class="hidden sm:inline">
            <input type="text" name="name" placeholder="find a player" autocomplete="off" 
                   class="border border-gray-300 px-2 py-1 text-xs w-48">
        </form>
    </div>

    <div class="flex items-center space-x-3">
        {% if user.is_authenticated and user.is_staff %}
        <!-- Admin dropdown -->
        <div class="nav-dropdown hidden sm:block">
            <span class="underline cursor-pointer">Utilities ▼</span>
            <div class="nav-dropdown-content min-w-48 dropdown-right">
                <a href="/special/trades/" class="block underline text-sm py-1">Trades: Process</a>
                <a href="/draft/live/2025/midseason/open/edit/" class="block underline text-sm py-1">Draft: Open</a>
                <a href="/draft/live/2025/midseason/aa/edit/" class="block underline text-sm py-1">Draft: AA</a>
                <a href="/special/players/" class="block underline text-sm py-1">Players: Utilities</a>
                <a href="/special/players/bulk/" class="block underline text-sm py-1">Players: Bulk add</a>
                <a href="/admin/" class="block underline font-bold text-sm py-1">Django admin</a>
            </div>
        </div>
        {% endif %}
        
        {% if user.is_authenticated %}
        <a href="/teams/{{ my_team.abbreviation|lower }}/" class="underline font-bold">My Team</a>
        <a href="/accounts/logout/" class="underline">Log out</a>
        {% else %}
        <a href="/accounts/login/" class="underline">Log in</a>
        {% endif %}
    </div>
</nav>

<!-- Mobile search dropdown (below main nav on XS only) -->
<div class="sm:hidden border-b border-gray-200 p-2">
  <button id="mobile-search-toggle" class="underline text-sm" aria-controls="mobile-search" aria-expanded="false">Search ▼</button>
  <div id="mobile-search" class="hidden mt-2">
    <form action="/search/name/" method="GET">
      <input type="text" name="name" placeholder="find a player" autocomplete="off" 
             class="border border-gray-300 px-2 py-2 text-sm w-full">
    </form>
  </div>
  </div>

<!-- Mobile full-screen menu -->
<div id="mobile-menu" class="fixed inset-0 bg-white z-50 hidden overflow-y-auto">
  <div class="p-4 space-y-4">
    <div class="flex items-center justify-between">
      <div class="font-bold text-lg">Menu</div>
      <button id="mobile-menu-close" class="border px-2 py-1 text-xs">Close</button>
    </div>

    <div class="space-y-2">
      <a href="https://docs.google.com/document/d/e/2PACX-1vQmtw4gpA19fxNIFbSQZrF22z92eYbbhWPd_11PmH9fr2_vCUjTrMqZh_J2ySre0qrxKv_qtK-E9BTh/pub" target="_blank" class="underline block">Constitution</a>
      <a href="/trades/" class="underline block">Trades</a>
      <div>
        <div class="font-bold mb-1">Drafts</div>
        <div class="grid grid-cols-4 gap-2 text-xs">
          {% for draft in draftnav|slice:":8" %}
            <a href="{{ draft.url }}" class="underline">{{ draft.title }}</a>
          {% endfor %}
        </div>
        <a href="/drafts/" class="underline block mt-2">More drafts</a>
      </div>
      <div>
        <div class="font-bold mb-1">Teams</div>
        <div class="grid grid-cols-4 gap-2 text-sm">
          {% for t in teamnav %}
            <a href="/teams/{{ t.abbreviation|lower }}/{% if value %}?value=true{% endif %}" class="underline">{{ t.abbreviation }}</a>
          {% endfor %}
        </div>
      </div>
      <div class="pt-2">
        {% if user.is_authenticated %}
        <a href="/teams/{{ my_team.abbreviation|lower }}/" class="underline font-bold mr-4">My Team</a>
        <a href="/accounts/logout/" class="underline">Log out</a>
        {% else %}
        <a href="/accounts/login/" class="underline">Log in</a>
        {% endif %}
      </div>
    </div>
  </div>
</div>
<script>
  // Enable tap-to-toggle for dropdowns on mobile
  document.addEventListener('DOMContentLoaded', function() {
    // Mobile search toggle
    const mobileSearchToggle = document.getElementById('mobile-search-toggle');
    const mobileSearch = document.getElementById('mobile-search');
    if (mobileSearchToggle && mobileSearch) {
      mobileSearchToggle.addEventListener('click', function(e){
        e.preventDefault();
        const isHidden = mobileSearch.classList.contains('hidden');
        if (isHidden) {
          mobileSearch.classList.remove('hidden');
          mobileSearchToggle.setAttribute('aria-expanded','true');
        } else {
          mobileSearch.classList.add('hidden');
          mobileSearchToggle.setAttribute('aria-expanded','false');
        }
        // Trigger header margin recalculation in base template
        window.dispatchEvent(new Event('resize'));
      });
    }
    // Mobile menu open/close
    const menuBtn = document.getElementById('mobile-menu-button');
    const menu = document.getElementById('mobile-menu');
    const menuClose = document.getElementById('mobile-menu-close');
    if (menuBtn && menu) {
      menuBtn.addEventListener('click', function(){ menu.classList.remove('hidden'); });
    }
    if (menuClose && menu) {
      menuClose.addEventListener('click', function(){ menu.classList.add('hidden'); });
    }

    document.querySelectorAll('.nav-dropdown > span').forEach(function(trigger) {
      trigger.addEventListener('click', function(e) {
        e.preventDefault();
        const parent = trigger.closest('.nav-dropdown');
        const isOpen = parent.classList.contains('open');
        // Close all
        document.querySelectorAll('.nav-dropdown.open').forEach(function(dd){ dd.classList.remove('open'); });
        // Toggle current
        if (!isOpen) parent.classList.add('open');
      });
    });
    // Click outside to close
    document.addEventListener('click', function(e){
      if (!e.target.closest('.nav-dropdown')) {
        document.querySelectorAll('.nav-dropdown.open').forEach(function(dd){ dd.classList.remove('open'); });
      }
    });
  });
  </script>

